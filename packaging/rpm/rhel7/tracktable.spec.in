Summary:          Tracktable C++ trajectory analysis and rendering library
Name:             tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@
Version:          @TRACKTABLE_VERSION@
Release:          @RPM_RELEASE@%{?dist}
License:          Other
URL:              https://tracktable.sandia.gov/
Group:            System Environment/Libraries
Source:           Tracktable-@TRACKTABLE_VERSION@-Source.tar.bz2
Vendor:           National Technology and Engineering Solutions of Sandia, LLC
BuildRoot:        %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildRequires:    doxygen
BuildRequires:    graphviz
BuildRequires:    boost169-devel >= 1.69
BuildRequires:    cmake3 >= 3.12
BuildRequires:    pkgconfig
Obsoletes:        tracktable

%description
Tracktable is a C++ trajectory and analysis library.

%package          devel
Summary:          C++ Headers for developing programs that will use the tracktable library
Group:            Development/Libraries
Requires:         tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@ = %{version}-%{release}
Requires:         boost169-devel >= 1.69
Requires:         pkgconfig
Obsoletes:        tracktable-devel

%description    devel
C++ libraries and header files needed for developing applications that
will use the tracktable library.

%package          doc
Summary:          Developer's documentation for the tracktable library
Group:            Documentation
BuildArch:        noarch
Obsoletes:        tracktable-doc

%description      doc
This package contains developer's documentation for the tracktable library.

%prep
%setup -q -n Tracktable-@TRACKTABLE_VERSION@-Source

%build
%cmake3 \
    -DBOOST_INCLUDEDIR=/usr/include/boost169/ \
    -DBOOST_LIBRARYDIR=/usr/lib64/boost169 \
    -DBUILD_EXAMPLES=OFF \
    -DBUILD_PYTHON_WRAPPING=OFF \
    -DBUILD_TESTING=OFF \
    -DCMAKE_INSTALL_LIBDIR:PATH=%{_libdir} \
    -DBUILD_DOCUMENTATION=ON \
    -DPYTHON_EXECUTABLE=python3.6 \
    .
    
%make_build %{?_smp_mflags}
%make_build doxygen_doc

%install
%make_install

for file in $(find Documentation/doxygen/html -type f); do
  install -p --mode=0664 -D ${file} %{buildroot}%{_datadir}/doc/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/cpp_reference/${file#"Documentation/doxygen/html/"}
done

%check
ctest3 -V %{?_smp_mflags}

%clean
%{__rm} -rf %{buildroot}

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%files
%defattr(-,root,root,-)
%{_libdir}/libTracktable*.so.*
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/LICENSE.txt
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/README.md

%files devel
%defattr(-,root,root,-)
%{_libdir}/libTracktable*.so
%{_libdir}/pkgconfig/@PKGCONFIG_FILE@
%{_includedir}/@TRACKTABLE_INCLUDEDIR@
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/LICENSE.txt
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/README.md

%files doc
%defattr(-,root,root,-)
%dir %{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/LICENSE.txt
%{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/README.md
%doc %{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/cpp_reference/
#%doc %{_docdir}/tracktable-@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@/html/

%changelog

* Mon Jan 20 2020 Rick L Vinyard Jr <rlvinya@sandia.gov> - 1.2.2-1
* Mon Jan 20 2020 Rick L Vinyard Jr <rlvinya@sandia.gov> - 1.2.2-1
- Initial version

